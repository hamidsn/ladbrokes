package com.example.ladbrokes.data.repositories

import com.example.ladbrokes.data.GREYHOUND_CATEGORY_ID
import com.example.ladbrokes.data.HARNESS_CATEGORY_ID
import com.example.ladbrokes.data.HORSE_CATEGORY_ID
import com.example.ladbrokes.data.NUMBER_OF_DISPLAYED_RACES
import com.example.ladbrokes.data.Result
import com.example.ladbrokes.data.source.remote.LadbrokesApi
import com.example.ladbrokes.data.source.remote.dto.RacesDto
import com.example.ladbrokes.data.source.remote.dto.toListRaces
import com.example.ladbrokes.domain.model.race.Race
import com.example.ladbrokes.domain.repositories.RaceRepository
import com.google.gson.Gson
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.flow
import retrofit2.HttpException
import java.io.IOException
import javax.inject.Inject

class FakeRaceRepositoryImpl @Inject constructor(
    private val api: LadbrokesApi
) : RaceRepository {

    var gson = Gson()
    private var data: RacesDto = gson.fromJson(
        """{"status":200,"data":{"next_to_go_ids":["f838f8a6-d2d9-40a6-9c83-d4313f24b6ed","839c2d31-a4d9-401b-96d8-ae323122882d","66329a74-e70c-4998-bf36-e60c8859120f","3658a143-f809-4cbb-874a-c661d20df3f6","fba6f3bc-ac30-410e-88fb-b65aebcae247","f6eb35fc-2e93-4642-b45c-aebe06acb83e","c0b2e9e8-4b82-441a-bc6c-3097fd8ac3fc","ff031a45-e7fd-42b9-a35f-2ac35942ee83","33caf4f5-d7b7-44f6-b8dd-c26dfe163229","ebdf621f-f7a1-4039-8b99-1ca9d61baefa"],"race_summaries":{"33caf4f5-d7b7-44f6-b8dd-c26dfe163229":{"race_id":"33caf4f5-d7b7-44f6-b8dd-c26dfe163229","race_name":"Ladbrokes Bet Ticker Division1","race_number":8,"meeting_id":"f62e1e68-2ecc-493b-b39f-ff023f0448b9","meeting_name":"Hobart","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688644500},"race_form":{"distance":461,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","weather":{"id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","name":"OCAST","short_name":"ocast","icon_uri":"OCAST"},"weather_id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","race_comment":"DEWANA DREAM (4) has shown good improvement at her last two starts, finishing in the money last time when 2nd at Launceston over 515m. Yet to win out of this box but has been in the placings five times from eight starts. One of the contenders. SMOKING YOGI (7) has been mixing form lately, hitting the frame two back before finishing fourth (26.51) at this track in a Grade 4. Key player on best and worth another try. TWICE BITTEN (5) had a tricky draw and ran well to finish second, beaten one length, (26.23) at this track. Has clocked a solid 26.01 best time here at this trip. Can feature again. ASHFIELD LASS (3) is in the mix despite missing out at this track last time.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Hobart\",\"state\":\"TAS\",\"country\":\"AUS\",\"number\":8,\"race_name\":\"Ladbrokes Bet Ticker Division1\",\"time\":\"2023-07-06T11:55:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"DEWANA DREAM (4) has shown good improvement at her last two starts, finishing in the money last time when 2nd at Launceston over 515m. Yet to win out of this box but has been in the placings five times from eight starts. One of the contenders. SMOKING YOGI (7) has been mixing form lately, hitting the frame two back before finishing fourth (26.51) at this track in a Grade 4. Key player on best and worth another try. TWICE BITTEN (5) had a tricky draw and ran well to finish second, beaten one length, (26.23) at this track. Has clocked a solid 26.01 best time here at this trip. Can feature again. ASHFIELD LASS (3) is in the mix despite missing out at this track last time."},"venue_id":"064e33ab-9ad8-41ae-be41-c19083abb2aa","venue_name":"Hobart","venue_state":"TAS","venue_country":"AUS"},"3658a143-f809-4cbb-874a-c661d20df3f6":{"race_id":"3658a143-f809-4cbb-874a-c661d20df3f6","race_name":"Race 12 - 1500","race_number":12,"meeting_id":"2e626955-9707-4900-a00b-1bb66fa89676","meeting_name":"Kawasaki","category_id":"4a2788f8-e825-4d36-9894-efd4baf1cfae","advertised_start":{"seconds":1688644200},"race_form":{"distance":1500,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"906cd562-a37c-11e7-a5c6-0ab32e6ac8d2","name":"Soft","short_name":"soft"},"track_condition_id":"906cd562-a37c-11e7-a5c6-0ab32e6ac8d2","weather":{"id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","name":"OCAST","short_name":"ocast","icon_uri":"OCAST"},"weather_id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","race_comment":"BIG LANCER (6) was in a different class last time, registering a dominant 6 length win over 1400m at this track to make it two wins in succession. Should camp just off the leaders. Looks very hard for these to stop him landing the hat trick. CHIHAYA (3) failed to live up to market expectations last start when out of the placings over 2000m at this track but there was merit in the resuming effort two back when fourth. Has the ability to put the recent poor run behind her. MOULIN AZUR (2) finished fourth last start over 1400m at this track. Has a good record at this course and distance, including two wins. Go well. ELIJAH (5) has won fresh before and the record at this distance is sound. Worth including.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Kawasaki\",\"state\":\"JPN\",\"country\":\"JPN\",\"number\":12,\"race_name\":\"\",\"time\":\"1970-01-01T00:00:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"BIG LANCER (6) was in a different class last time, registering a dominant 6 length win over 1400m at this track to make it two wins in succession. Should camp just off the leaders. Looks very hard for these to stop him landing the hat trick. CHIHAYA (3) failed to live up to market expectations last start when out of the placings over 2000m at this track but there was merit in the resuming effort two back when fourth. Has the ability to put the recent poor run behind her. MOULIN AZUR (2) finished fourth last start over 1400m at this track. Has a good record at this course and distance, including two wins. Go well. ELIJAH (5) has won fresh before and the record at this distance is sound. Worth including."},"venue_id":"54fd43ae-62e7-4fff-a114-1ebd5378e3a7","venue_name":"Kawasaki","venue_state":"JPN","venue_country":"JPN"},"66329a74-e70c-4998-bf36-e60c8859120f":{"race_id":"66329a74-e70c-4998-bf36-e60c8859120f","race_name":"Greyhounds As Pets (N/P) Stake Cta Division1","race_number":8,"meeting_id":"57188fbd-3774-425b-8e92-0c871445e945","meeting_name":"Angle Park","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688644140},"race_form":{"distance":595,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","weather":{"id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","name":"OCAST","short_name":"ocast","icon_uri":"OCAST"},"weather_id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","race_comment":"RAVERS ARMY (3) continued his winning form with another strong run after leading them home to make it two on the bounce when scoring by 2 lengths (34.43) at this track over 595. Recorded the quickest time on the card last start. Looks the testing material. ZOE ROSE (1) doesn't win out of turn. Hit the board with a minor placing last time when third (34.59) at this track. Has a good record here including two wins. Expected to feature. HE'S ALL PURPOSE (8) has a strong record this trip with three wins and two placings from nine starts. Comes off a (30.85) win last time, scoring by 2 lengths in a Grade 4/5 over 531m at Gawler. Suited here and expected to run well.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Angle Park\",\"state\":\"SA\",\"country\":\"AUS\",\"number\":8,\"race_name\":\"Greyhounds As Pets (N/P) Stake Cta Division1\",\"time\":\"2023-07-06T11:49:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"RAVERS ARMY (3) continued his winning form with another strong run after leading them home to make it two on the bounce when scoring by 2 lengths (34.43) at this track over 595. Recorded the quickest time on the card last start. Looks the testing material. ZOE ROSE (1) doesn't win out of turn. Hit the board with a minor placing last time when third (34.59) at this track. Has a good record here including two wins. Expected to feature. HE'S ALL PURPOSE (8) has a strong record this trip with three wins and two placings from nine starts. Comes off a (30.85) win last time, scoring by 2 lengths in a Grade 4/5 over 531m at Gawler. Suited here and expected to run well."},"venue_id":"2fd9ea87-0e6c-4b7d-997d-20d6da4f352a","venue_name":"Angle Park","venue_state":"SA","venue_country":"AUS"},"839c2d31-a4d9-401b-96d8-ae323122882d":{"race_id":"839c2d31-a4d9-401b-96d8-ae323122882d","race_name":"Race 9","race_number":9,"meeting_id":"fbe53459-4fe4-4aaf-8f80-55237413f23b","meeting_name":"Towcester Bags","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688643960},"race_form":{"distance":270,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","race_comment":"SAVANA BOMBAY (3) is better than last start when fifth (16.83) from Box 5 at this track over 270m. Has ability and can bounce back. WOOD MISTY (1) is a last start placegetter in a D2, jumping from this trap and finishing a 3.5 lengths third over 270m at this track. Boasts a strong record off this same box, including eight wins and 12 placings from 39 starts. This tougher but looks a leading chance again. BEMYANGELROSA (2) is overdue for a win after recording back to back placings, the latest jumping from this same trap when a 2.25 lengths third (16.40) in a D2 at this track. Harder here but will be in this for a long way. MAKEIT RUMBLE (4) has to be respected despite coming off a three-and-a-half months break.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Towcester Bags\",\"state\":\"UK\",\"country\":\"UK\",\"number\":9,\"race_name\":\"Race 9\",\"time\":\"2023-07-06T11:46:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"SAVANA BOMBAY (3) is better than last start when fifth (16.83) from Box 5 at this track over 270m. Has ability and can bounce back. WOOD MISTY (1) is a last start placegetter in a D2, jumping from this trap and finishing a 3.5 lengths third over 270m at this track. Boasts a strong record off this same box, including eight wins and 12 placings from 39 starts. This tougher but looks a leading chance again. BEMYANGELROSA (2) is overdue for a win after recording back to back placings, the latest jumping from this same trap when a 2.25 lengths third (16.40) in a D2 at this track. Harder here but will be in this for a long way. MAKEIT RUMBLE (4) has to be respected despite coming off a three-and-a-half months break."},"venue_id":"8d3bedc2-6367-4077-9f19-125440c71c47","venue_name":"Towcester Bags","venue_state":"UK","venue_country":"UK"},"c0b2e9e8-4b82-441a-bc6c-3097fd8ac3fc":{"race_id":"c0b2e9e8-4b82-441a-bc6c-3097fd8ac3fc","race_name":"Download The Watchdog App","race_number":11,"meeting_id":"9e451b88-a94a-4f26-8379-3cc1cbb2d304","meeting_name":"Sandown Park","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688644320},"race_form":{"distance":515,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","weather":{"id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","name":"OCAST","short_name":"ocast","icon_uri":"OCAST"},"weather_id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","race_comment":"HEBRIDEAN BLACK (5) started big odds last time but hit the ground running with a strong early split, giving a sight but fading only late to finish second (29.64) at this track over 515m. Deserves serious consideration. ONE'S OBSESSION (7) has a strong overall record having 15 wins and 20 places from 52 starts but was out of the money last time when fourth (29.75) over 515m at this track. Looks well placed here and has the ability. Go well. TESSA NATURE (1) turned in a solid run last start over 515m at this track finishing 5th and beaten only 1.4 lengths (30.14). Likely to be about the mark. DOWNSTREAM (2) is worth another chance despite missing the top-three here most recently.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Sandown Park\",\"state\":\"VIC\",\"country\":\"AUS\",\"number\":11,\"race_name\":\"Download The Watchdog App\",\"time\":\"2023-07-06T11:52:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"HEBRIDEAN BLACK (5) started big odds last time but hit the ground running with a strong early split, giving a sight but fading only late to finish second (29.64) at this track over 515m. Deserves serious consideration. ONE'S OBSESSION (7) has a strong overall record having 15 wins and 20 places from 52 starts but was out of the money last time when fourth (29.75) over 515m at this track. Looks well placed here and has the ability. Go well. TESSA NATURE (1) turned in a solid run last start over 515m at this track finishing 5th and beaten only 1.4 lengths (30.14). Likely to be about the mark. DOWNSTREAM (2) is worth another chance despite missing the top-three here most recently."},"venue_id":"069d069b-b7aa-44a1-a484-64e9701a09f9","venue_name":"Sandown Park","venue_state":"VIC","venue_country":"AUS"},"ebdf621f-f7a1-4039-8b99-1ca9d61baefa":{"race_id":"ebdf621f-f7a1-4039-8b99-1ca9d61baefa","race_name":"Ssang Yong @ Sinclair Ford Kingswood Pace","race_number":8,"meeting_id":"e69f7b8a-79c7-478d-ae20-443f18151d8e","meeting_name":"Penrith","category_id":"161d9be2-e909-4326-8c2c-35ed71fb460b","advertised_start":{"seconds":1688644620},"race_form":{"distance":2125,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"1db9cab0-b747-11ea-80cf-6a390f79827e","name":"Fast","short_name":"fast"},"track_condition_id":"1db9cab0-b747-11ea-80cf-6a390f79827e","weather":{"id":"08e5f78c-1a36-11eb-9269-cef03e67f1a3","name":"FINE","short_name":"fine","icon_uri":"FINE"},"weather_id":"08e5f78c-1a36-11eb-9269-cef03e67f1a3","race_comment":"FIELDS OF BETHANY (3) is racing consistently having continued a run of top-four finishes at this circuit when beaten 6.5m from a second line draw last week. A more favourable barrier gives her every chance to break through. TIGERS SPIRIT (9) made an encouraging return when he led and stuck on for a 4.6m second here last week. Tougher draw but will be fitter with that hitout under the belt. HEY DUDE (7) was midfield when resuming last week. Draws the second line again but is closer to the pegs and is open to improvement. MERRYWOOD MAX (6) didn't feature last time but is worth another chance having kicked off the campaign with back-to-back seconds.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Penrith\",\"state\":\"NSW\",\"country\":\"AUS\",\"number\":8,\"race_name\":\"Ssang Yong @ Sinclair Ford Kingswood Pace\",\"time\":\"2023-07-06T11:57:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"FIELDS OF BETHANY (3) is racing consistently having continued a run of top-four finishes at this circuit when beaten 6.5m from a second line draw last week. A more favourable barrier gives her every chance to break through. TIGERS SPIRIT (9) made an encouraging return when he led and stuck on for a 4.6m second here last week. Tougher draw but will be fitter with that hitout under the belt. HEY DUDE (7) was midfield when resuming last week. Draws the second line again but is closer to the pegs and is open to improvement. MERRYWOOD MAX (6) didn't feature last time but is worth another chance having kicked off the campaign with back-to-back seconds."},"venue_id":"f00be2d6-0109-4fb4-bda8-8dee3a759d51","venue_name":"Penrith","venue_state":"NSW","venue_country":"AUS"},"f6eb35fc-2e93-4642-b45c-aebe06acb83e":{"race_id":"f6eb35fc-2e93-4642-b45c-aebe06acb83e","race_name":"Race 8","race_number":8,"meeting_id":"a7b25d64-04a3-4291-a8e5-a28b56f14c90","meeting_name":"Nottingham Bags","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688644260},"race_form":{"distance":500,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","weather":{"id":"08e5f78c-1a36-11eb-9269-cef03e67f1a3","name":"FINE","short_name":"fine","icon_uri":"FINE"},"weather_id":"08e5f78c-1a36-11eb-9269-cef03e67f1a3","race_comment":"MAGNITUDE (2) is rarely out of the finish, recording 15 places from 27 starts. Better run when finding the frame last time though, finishing third (30.65) at this track. Has a swift 30.16 PB at this course and distance. Sure to be about the mark. PEADS NEWS (5) was never in contention last time at this track, but prior to that won by a nose at this track (30.75) beating TIPPERARY in an A5 on June 26. Will give the top chances plenty to think about. SEANY FIVE O (6) jumped from the same trap last time when a 3 length third (29.88) at this track over 480m. Should be in this for a long way. TYSONS ZEUS (3) is a last-start placegetter with solid claims again.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"\",\"state\":\"\",\"country\":\"\",\"number\":0,\"race_name\":\"\",\"time\":\"1970-01-01T00:00:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"MAGNITUDE (2) is rarely out of the finish, recording 15 places from 27 starts. Better run when finding the frame last time though, finishing third (30.65) at this track. Has a swift 30.16 PB at this course and distance. Sure to be about the mark. PEADS NEWS (5) was never in contention last time at this track, but prior to that won by a nose at this track (30.75) beating TIPPERARY in an A5 on June 26. Will give the top chances plenty to think about. SEANY FIVE O (6) jumped from the same trap last time when a 3 length third (29.88) at this track over 480m. Should be in this for a long way. TYSONS ZEUS (3) is a last-start placegetter with solid claims again."},"venue_id":"636a41e4-d85c-42e8-931c-f9a4f7ec013b","venue_name":"Nottingham Bags","venue_state":"UK","venue_country":"UK"},"f838f8a6-d2d9-40a6-9c83-d4313f24b6ed":{"race_id":"f838f8a6-d2d9-40a6-9c83-d4313f24b6ed","race_name":"Bet Local Bet Tabtouch","race_number":10,"meeting_id":"7bce729f-6059-43a9-8d99-d9ebe501692d","meeting_name":"Northam","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688643960},"race_form":{"distance":297,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","weather":{"id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","name":"OCAST","short_name":"ocast","icon_uri":"OCAST"},"weather_id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","race_comment":"LIBERTY POP (1) comes off an average performance last start when fifth at this track over 297m behind Hummingbird Hana (17.93) in a Grade 5. Should be very hard to beat this time. WISE COUSIN GLEN (4) has a strong record this journey with two wins and a minor from four starts. Below best last time at this track (17.90) in a Grade 4/5, finishing a 7 length sixth. Looks well placed here and among the chances. FIRE FLY CAROLE (2) was responsible for a modest effort most recently when fifth at this track over 297m behind Moment In Bondi (17.75) in a Free For All. Was in the money prior to that. Has clocked a solid 17.32 best time here at this trip. Better than last start and can bounce back. WESTDALE DAVE (3) is always hard to beat when he races here at this trip.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Northam\",\"state\":\"WA\",\"country\":\"AUS\",\"number\":10,\"race_name\":\"Bet Local Bet Tabtouch\",\"time\":\"2023-07-06T11:46:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"LIBERTY POP (1) comes off an average performance last start when fifth at this track over 297m behind Hummingbird Hana (17.93) in a Grade 5. Should be very hard to beat this time. WISE COUSIN GLEN (4) has a strong record this journey with two wins and a minor from four starts. Below best last time at this track (17.90) in a Grade 4/5, finishing a 7 length sixth. Looks well placed here and among the chances. FIRE FLY CAROLE (2) was responsible for a modest effort most recently when fifth at this track over 297m behind Moment In Bondi (17.75) in a Free For All. Was in the money prior to that. Has clocked a solid 17.32 best time here at this trip. Better than last start and can bounce back. WESTDALE DAVE (3) is always hard to beat when he races here at this trip."},"venue_id":"648e859c-9c11-4660-81f7-26fe1c148150","venue_name":"Northam","venue_state":"WA","venue_country":"AUS"},"fba6f3bc-ac30-410e-88fb-b65aebcae247":{"race_id":"fba6f3bc-ac30-410e-88fb-b65aebcae247","race_name":"Prix Fauchelevent","race_number":3,"meeting_id":"c1dcdad2-5bed-45a2-9a28-053629e29101","meeting_name":"Nantes","category_id":"4a2788f8-e825-4d36-9894-efd4baf1cfae","advertised_start":{"seconds":1688644200},"race_form":{"distance":1600,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","weather":{"id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","name":"OCAST","short_name":"ocast","icon_uri":"OCAST"},"weather_id":"5ba75165-3cec-11eb-88bb-36fbfdf5d97f","race_comment":"PANDIA SELENE (7) is selected to break her maiden following a 1.5L third in a 1650m event at Craon. DSCHINGIS GALI (4) ended last year with a 3.5L fifth attempting a 1650m maiden at Craon early September. Expected to go well on seasonal reappearance. CELTIC ARYAAN (1) makes the shortlist after a dead-heat second in a 1600m maiden here. LADY REGENT (10) ran 2.5L fifth tackling a 1650m maiden at Craon. Consider for the win.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Nantes\",\"state\":\"FR\",\"country\":\"FR\",\"number\":3,\"race_name\":\"\",\"time\":\"1970-01-01T00:00:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"PANDIA SELENE (7) is selected to break her maiden following a 1.5L third in a 1650m event at Craon. DSCHINGIS GALI (4) ended last year with a 3.5L fifth attempting a 1650m maiden at Craon early September. Expected to go well on seasonal reappearance. CELTIC ARYAAN (1) makes the shortlist after a dead-heat second in a 1600m maiden here. LADY REGENT (10) ran 2.5L fifth tackling a 1650m maiden at Craon. Consider for the win."},"venue_id":"9e170b30-33af-4336-8989-a6ff96719466","venue_name":"Nantes","venue_state":"FR","venue_country":"FR"},"ff031a45-e7fd-42b9-a35f-2ac35942ee83":{"race_id":"ff031a45-e7fd-42b9-a35f-2ac35942ee83","race_name":"The Suffolk Standard","race_number":9,"meeting_id":"90f11d76-3bd6-47d5-b89b-7000aa06dd69","meeting_name":"Suffolk Downs Am","category_id":"9daef0d7-bf3c-4f50-921d-8e818c60fe61","advertised_start":{"seconds":1688644440},"race_form":{"distance":388,"distance_type":{"id":"570775ae-09ec-42d5-989d-7c8f06366aa7","name":"Metres","short_name":"m"},"distance_type_id":"570775ae-09ec-42d5-989d-7c8f06366aa7","track_condition":{"id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","name":"Good","short_name":"good"},"track_condition_id":"10a14653-a33d-11e7-810d-0a1a4ae29bd2","race_comment":"BETTYS JACK (4) was an impressive winner last time, jumping from the same trap to score by 6 lengths in a OR over 462m at Great Yarmouth. Looks the one to beat again. SAVANA SUGAR (2) is worth forgiving last start after finishing fourth (24.60) from Box 3 at this track over 388m. Her PB at this course and distance is an excellent 23.82. One of the main contenders. NEWTOWN PONGO (3) is a consistent dog overall, in the frame at 17 of 42 starts including 11 wins but missed the frame latest when sixth (35.65) over 548m at this track. Has a good overall strike-rate and can find the frame here. DROOPYS OPTIMAL (6) has been freshened and can sneak into the frame on her best form.","additional_data":"{\"revealed_race_info\":{\"track_name\":\"Suffolk Downs Am\",\"state\":\"UK\",\"country\":\"UK\",\"number\":9,\"race_name\":\"The Suffolk Standard\",\"time\":\"1970-01-01T00:00:00Z\"}}","generated":1,"silk_base_url":"drr38safykj6s.cloudfront.net","race_comment_alternative":"BETTYS JACK (4) was an impressive winner last time, jumping from the same trap to score by 6 lengths in a OR over 462m at Great Yarmouth. Looks the one to beat again. SAVANA SUGAR (2) is worth forgiving last start after finishing fourth (24.60) from Box 3 at this track over 388m. Her PB at this course and distance is an excellent 23.82. One of the main contenders. NEWTOWN PONGO (3) is a consistent dog overall, in the frame at 17 of 42 starts including 11 wins but missed the frame latest when sixth (35.65) over 548m at this track. Has a good overall strike-rate and can find the frame here. DROOPYS OPTIMAL (6) has been freshened and can sneak into the frame on her best form."},"venue_id":"35d41a93-9295-4dba-b5be-b76a6548fc17","venue_name":"Suffolk Downs Am","venue_state":"UK","venue_country":"UK"}}},"message":"Next 10 races from each category"}""",
        RacesDto::class.java
    )

    override fun getRaces(page: Int): Flow<Result<List<Race>>> = flow {
        emit(Result.Loading())
        try {
            val response = data.toListRaces()
            emit(Result.Success(response))
        } catch (e: HttpException) {
            emit(
                Result.Error(
                    message = "Oops, something went wrong",
                    data = null
                )
            )
        } catch (e: IOException) {
            emit(
                Result.Error(
                    message = "Couldn't reach server, check your internet connection",
                    data = null
                )
            )
        }
    }

    override suspend fun getTimeFilteredRaces(
        selectedSeconds: Long,
        list: List<Race>?
    ): Flow<Result<List<Race>>> = flow {
        val response = if ((list?.size ?: 0) < NUMBER_OF_DISPLAYED_RACES) {
            data.toListRaces()
        } else {
            //offline-first
            list?.filter { it.seconds != selectedSeconds }
        }

        emit(Result.Success(response))
    }

    override suspend fun getCategoryFilteredRaces(
        noFilters: Boolean,
        filterList: Array<Boolean>,
        list: List<Race>?
    ): Flow<Result<List<Race>>> = flow {

        val predicates: List<(Race) -> Boolean> = listOf(
            { race: Race ->
                if (!noFilters && race.categoryId == GREYHOUND_CATEGORY_ID) {
                    filterList[0]
                } else true
            },
            { race: Race ->
                if (!noFilters && race.categoryId == HARNESS_CATEGORY_ID) {
                    filterList[1]
                } else true
            },
            { race: Race ->
                if (!noFilters && race.categoryId == HORSE_CATEGORY_ID) {
                    filterList[2]
                } else true
            }
        )

        val response = if ((list?.size ?: 0) < NUMBER_OF_DISPLAYED_RACES) {
            data.toListRaces().filter { candidate ->
                predicates.all { it(candidate) }
            }
        } else {
            //offline-first
            list?.filter { candidate ->
                predicates.all { it(candidate) }
            }
        }

        emit(Result.Success(response))
    }


}